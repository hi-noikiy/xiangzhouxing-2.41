!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).anim=e()}(this,function(){"use strict";const t=["onLoad","onShow","onReady","onHide","onUnload","onPullDownRefresh","onReachBottom","onPageScroll","onResize"],e=["data","computed","watch"];function n(n){const o=n.reduce((n,o)=>(Object.keys(o).forEach(c=>{if(t.includes(c))return n[c].push(o[c]);e.includes(c)?n[c]=Object.assign({},n[c],o[c]):n[c]=o[c]}),n),function(){const e=t.reduce((t,e)=>(t[e]=[],t),{});return Object.assign({mixins:[],data:{}},e)}());return c=o,t.reduce((t,e)=>(t[e]&&t[e].length>0?(t[`__anim_${e}`]=t[e].slice(),t[e]=function(...n){t[`__anim_${e}`].forEach(t=>{t.apply(this,n)})}):delete t[e],t),c);var c}let o=0;class c{constructor(){this.subs=[],this.id=++o}addSub(t){this.subs.push(t)}depend(){c.target&&c.target.addDep(this)}notify(){this.subs.forEach(t=>{setTimeout(()=>t.update())})}}let r=0;class a{constructor(t,e,n){this.id=++r,this.depIdMap={},this.dep=new c,this.vm=t,this.fn=e,this.cb=n,this.value=this.getValue(),this.oldValue=void 0}getValue(){c.target=this;const t=this.fn.call(this.vm);return c.target=void 0,t}update(){this.oldValue=this.value,this.value=this.getValue(),this.cb.call(this.vm)}addDep(t){this.depIdMap.hasOwnProperty(t.id)||(t.addSub(this),this.depIdMap[t.id]=t)}depend(){this.dep.depend()}}function i(t,e,n,o){var c,r=!1,a=0;function i(){c&&clearTimeout(c)}function s(){var s=this,u=Date.now()-a,l=arguments;function d(){a=Date.now(),n.apply(s,l)}r||(o&&!c&&d(),i(),void 0===o&&u>t?d():!0!==e&&(c=setTimeout(o?function(){c=void 0}:d,void 0===o?t-u:t)))}return"boolean"!=typeof e&&(o=n,n=e,e=void 0),s.cancel=function(){i(),r=!0},s}function s(t,e,n){return void 0===n?i(t,e,!1):i(t,n,!1!==e)}function u(t){return String.prototype.split.call(t,/[,[\].]+?/).filter(Boolean)}function l(t){if(!t.watch)return;let e={};Object.keys(t.watch).forEach(n=>{const o=t.watch[n];if("function"!=typeof o)return;const c=u(n).slice(0,-1),r=u(n).slice(-1)[0]||n;e[n]=function(t,e,n=null){return u(e).reduce((t,e)=>Object.hasOwnProperty.call(t,e)?t[e]:n,t)}(t.data,n);let a=t.data;c.forEach(t=>{a=a[t]});const i=Object.getOwnPropertyDescriptor(a,r);i&&Object.defineProperty(a,r,{configurable:i.configurable,enumerable:i.enumerable,get:()=>i&&i.get?i.get():e[n],set:s(10,function(c){const r=e[n];o.call(t,c,r),i&&i.set&&i.set(c),e[n]=c})})})}const d={onLoad(){var t;"object"==typeof(t=this).data&&"null"!==t.data&&Object.keys(t.data).forEach(e=>{let n=Object.assign({},t.data)[e];const o=new c;Object.defineProperty(t.data,e,{set(t){t===n||t!=t&&n!=n||(n=t,o.notify())},get:()=>(o.depend(),n)})}),(t=>{wx.nextTick?wx.nextTick(()=>l(t)):setTimeout(()=>l(t))})(this),function(t){if(!t.computed)return;const e={};Object.keys(t.computed).forEach(n=>{const o=t.computed[n];if("function"!=typeof o)return;const c=new a(t,o,()=>{t.setData&&t.setData({[n]:c.value})});t.data[n]=c.value,e[n]=c.value,Object.defineProperty(t.data,n,{configurable:!0,enumerable:!0,set:t=>t,get:()=>(c.depend(),c.value)})}),t.setData&&t.setData(e)}(this)}};const f=Object.keys(wx).filter(t=>t.endsWith("Sync")).map(t=>t.replace(/Sync$/,"")).concat(["navigateTo","navigateBack","redirectTo","reLaunch"]).concat(["request","downloadFile","uploadFile"]).reduce((t,e)=>(t[e]=function(t){return function(e){return new Promise((n,o)=>{t(Object.assign({},e,{success(t){e.success&&e.success(t),n(t)},fail(t){e.fail&&e.fail(t),o(t)}}))})}}(wx[e]),t),{}),h=Object.assign({},wx,f);let p=[];function y(t={}){const e=getCurrentPages().slice(-1)[0];let n;n=t.__anim__query?JSON.parse(decodeURIComponent(t.__anim__query)):{};const o={path:e.route,query:n};var c;this.$route=o,this.setData&&this.setData({$route:o}),(c=this).$router={navigateTo:t=>(t.__anim_route_type="navigateTo",p.length<10?h.navigateTo({url:b(t)}):c.$router.redirectTo(t)),navigateBack:(t=1)=>h.navigateBack({delta:t}),redirectTo:t=>(t.__anim_route_type="redirectTo",h.redirectTo({url:b(t)})),reLaunch:t=>(t.__anim_route_type="reLaunch",h.reLaunch({url:b(t)})),switchTab:t=>(t.__anim_route_type="switchTab",h.switchTab({url:b(t)})),go(t){if(t<0)return h.navigateBack({delta:Math.abs(t)})}},"reLaunch"===n.__anim_route_type?p=[o]:p.push(o),this.$routes=p}function b(t){const e=encodeURIComponent(JSON.stringify(Object.assign({},t.query,{__anim_route_type:t.__anim_route_type})));return`${t.path}?__anim__query=${e}`}const _={onLoad(t){y.call(this,t)},onUnload(){(function(){p.pop()}).call(this)}},g={},j=[],m=function(t,e){if(Object.prototype.toString.call(t)!==Object.prototype.toString.call(e))return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;let n=!0;return Object.keys(t).forEach(o=>{switch(Object.prototype.toString.call(t[o])){case"[object Object]":m(t[o],e[o])||(n=!1);break;case"[object Array]":O(t[o],e[o])||(n=!1);break;default:t[o]!==e[o]&&(n=!1)}}),n},O=(t,e)=>{if(Object.prototype.toString.call(t)!==Object.prototype.toString.call(e))return!1;if(t.length!==e.length)return!1;let n=!0;return t.forEach((t,o)=>{t!==e[o]&&(n=!1)}),n},v=function(t,e){let n={};return Object.keys(t).forEach(o=>{if(!e||e.includes(o))switch(Object.prototype.toString.call(t[o])){case"[object Object]":n[o]=v(t[o]);break;case"[object Array]":n[o]=w(t[o]);break;default:n[o]=t[o]}}),n},w=t=>t.map(t=>{switch(Object.prototype.toString.call(t)){case"[object Object]":return v(t);case"[object Array]":return w(t);default:return t}}),k=t=>{const e=Object.prototype.toString.call(t);return"[object Object]"===e||"[object Array]"===e};const x=5;let T=0;const{system:S}=wx.getSystemInfoSync();let P;try{P=Proxy}catch(t){P=function(t,e){const n=Object.create(t.constructor.prototype,{__proxyhandler__:{value:e}});return Object.keys(t).forEach(e=>{Object.defineProperty(n,e,{enumerable:!0,get:function(){return this.__proxyhandler__.get(t,e)},set:function(n){return this.__proxyhandler__.set(t,e,n)}})}),n}}var D=P;const E=(t,e)=>(Object.keys(t).forEach(n=>{k(t[n])&&(t[n]=E(t[n],e.concat([n])))}),new D(t,{get(t,n){if("__isProxy"===n)return!0;if("__data"===n)return L(e);const o=L(e.concat([n]));return void 0!==o?o:Reflect.get(t,n)},set(t,n,o){const c=o.__isProxy&&o.__data||o,r=k(c)&&E(v(c),e.concat([n]))||c,a=Reflect.set(t,n,r);return $(e.concat([n]),c),T++,setTimeout(()=>{if(0==--T)for(let t=j.length-1;t>=0;t--){const[e,n,o]=j[t],c=n(g);m(o,c)||(j[t][2]=v(c),e.setData(c))}},x),a}})),L=t=>t.reduce((t,e)=>t&&t[e]||void 0,g),$=(t,e)=>{const n=t.length,o=t[n-1];let c=g;t.forEach((t,e)=>{e!==n-1&&(c=c[t])}),c[o]=e},A=function(t){return function(e){const{onLoad:n,onUnload:o}=e;return e.onLoad=function(){const e=t(g);j.push([this,t,v(e)]),this.setData(e),n&&n.apply(this,arguments)},e.onUnload=function(){j.pop(),o&&o.call(this)},e}},R=function(t,e){e=e||t.constructor.name.toLowerCase();const n=Object.getOwnPropertyNames(t);return t.__storeName__=e,g[e]||(g[e]=v(t,n)),E(t,[e])};var q=Object.freeze({mapToData:A,observe:R});let B=[d,_];function I(t){let e=B.slice();Array.isArray(t.mixins)&&(e=e.concat(t.mixins));const o=n(e.concat(t));if(o.store&&"function"==typeof o.store){const t=A(o.store);return Page(t(o))}return Page(o)}return I.mixin=(t=>{B=B.concat(t)}),{App:function(t){return App(t)},Page:I,wedux:q,wechat:h}});
